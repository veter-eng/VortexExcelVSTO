<UserControl x:Class="VortexExcelAddIn.Views.ConfigPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:VortexExcelAddIn">

    <UserControl.Resources>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="15">
            <TextBlock Text="Configuração do Banco de Dados" FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

            <!-- Seleção de Tipo de Banco de Dados -->
            <StackPanel Margin="0,0,0,15">
                <TextBlock Text="Tipo de Banco de Dados:" FontWeight="Medium" Margin="0,0,0,5"/>
                <ComboBox ItemsSource="{Binding AvailableDatabaseTypes}"
                          DisplayMemberPath="DisplayName"
                          SelectedValuePath="Type"
                          SelectedValue="{Binding SelectedDatabaseType, Mode=TwoWay}"
                          Padding="8,6"
                          Margin="0,0,0,5"/>
                <TextBlock Text="Selecione o banco de dados que deseja conectar" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
            </StackPanel>

            <!-- Campos para InfluxDB -->
            <GroupBox Header="Configuração InfluxDB"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- URL -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="URL do InfluxDB:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Url, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Exemplo: http://localhost:8086" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- Token -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Token de API:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Token, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Token de autenticação do InfluxDB" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- Organização -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Organização:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Org, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Bucket -->
                    <StackPanel Margin="0,0,0,0">
                        <TextBlock Text="Bucket:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Bucket, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Campos para Bancos Relacionais -->
            <GroupBox Header="Configuração de Conexão"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource BoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- Host -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Host:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Host, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Exemplo: localhost ou 192.168.1.100" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- Porta -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Porta:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Porta padrão (PostgreSQL: 5432, MySQL: 3306, SQL Server: 1433, Oracle: 1521)" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- Nome do Banco -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Nome do Banco de Dados:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding DatabaseName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Usuário -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Usuário:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Senha -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Senha:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <PasswordBox x:Name="PasswordBox" PasswordChanged="PasswordBox_OnPasswordChanged" Padding="8,6"/>
                        <TextBlock Text="A senha será criptografada com DPAPI antes de ser salva" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- SSL -->
                    <CheckBox Content="Usar SSL/TLS" IsChecked="{Binding UseSsl}" Margin="0,5,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Configuração de Tabela/Schema (apenas para bancos relacionais) -->
            <GroupBox Header="Configuração de Tabela"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource BoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- Schema -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Schema:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding SchemaName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Exemplo: public (PostgreSQL), dbo (SQL Server)" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- Nome da Tabela -->
                    <StackPanel Margin="0,0,0,0">
                        <TextBlock Text="Nome da Tabela:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding TableName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                        <TextBlock Text="Exemplo: dados_airflow, dados_maquinas" FontSize="11" Foreground="#666666" FontStyle="Italic"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Botões -->
            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <Button Content="Salvar e Conectar"
                        Command="{Binding SaveCommand}"
                        Background="#4472C4"
                        Foreground="White"
                        Padding="12,6"
                        Margin="5"
                        IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBoolConverter}}"/>

                <Button Content="Testar Conexão"
                        Command="{Binding TestConnectionCommand}"
                        Background="#7F7F7F"
                        Foreground="White"
                        Padding="12,6"
                        Margin="5"
                        IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"/>
            </StackPanel>

            <!-- Status -->
            <GroupBox Header="Status da Conexão" Margin="0,20,0,0" Padding="10">
                <StackPanel>
                    <TextBlock Text="{Binding StatusMessage}"
                               TextWrapping="Wrap"
                               Foreground="{Binding StatusMessageColor}"/>

                    <StackPanel Visibility="{Binding IsConnected, Converter={StaticResource BoolToVisibilityConverter}}"
                                Margin="0,10,0,0">
                        <TextBlock Text="✓ Conectado com sucesso!"
                                   FontWeight="Bold"
                                   Foreground="Green"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>
