<UserControl x:Class="VortexExcelAddIn.Views.ConfigPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:VortexExcelAddIn">

    <UserControl.Resources>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>

        <!-- Estilo para ícone de informação -->
        <Style x:Key="InfoIconStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="ⓘ"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#4472C4"/>
            <Setter Property="Cursor" Value="Help"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="15">
            <TextBlock Text="Configuração do Banco de Dados" FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

            <!-- Seleção de Tipo de Conexão -->
            <StackPanel Margin="0,0,0,15">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <TextBlock Text="Tipo de Conexão:" FontWeight="Medium"/>
                    <TextBlock Style="{StaticResource InfoIconStyle}">
                        <TextBlock.ToolTip>
                            <ToolTip Content="Selecione o tipo de conexão que deseja configurar"/>
                        </TextBlock.ToolTip>
                    </TextBlock>
                </StackPanel>
                <ComboBox ItemsSource="{Binding AvailableDatabaseTypes}"
                          DisplayMemberPath="DisplayName"
                          SelectedValuePath="Type"
                          SelectedValue="{Binding SelectedDatabaseType, Mode=TwoWay}"
                          Padding="8,6"/>
            </StackPanel>

            <!-- Campos para InfluxDB -->
            <GroupBox Header="Configuração Vortex Historian"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- Token -->
                    <StackPanel Margin="0,0,0,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Token de API:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="Token de autenticação do Servidor Vortex Historian"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <TextBox Text="{Binding Token, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Campos para Bancos Relacionais -->
            <GroupBox Header="Configuração de Conexão"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource BoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- Host -->
                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Host:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="Exemplo: localhost ou 192.168.1.100"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <TextBox Text="{Binding Host, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Porta -->
                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Porta:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="Porta padrão (PostgreSQL: 5432, MySQL: 3306, SQL Server: 1433, Oracle: 1521)"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Nome do Banco -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Nome do Banco de Dados:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding DatabaseName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Usuário -->
                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Usuário:" FontWeight="Medium" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Senha -->
                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Senha:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="A senha será criptografada com DPAPI antes de ser salva"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <PasswordBox x:Name="PasswordBox" PasswordChanged="PasswordBox_OnPasswordChanged" Padding="8,6"/>
                    </StackPanel>

                    <!-- SSL -->
                    <CheckBox Content="Usar SSL/TLS" IsChecked="{Binding UseSsl}" Margin="0,5,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Configuração de Tabela/Schema (apenas para bancos relacionais) -->
            <GroupBox Header="Configuração de Tabela"
                      Visibility="{Binding IsRelationalDatabase, Converter={StaticResource BoolToVisibilityConverter}}"
                      Margin="0,0,0,15"
                      Padding="10">
                <StackPanel>
                    <!-- Schema -->
                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Schema:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="Exemplo: public (PostgreSQL), dbo (SQL Server)"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <TextBox Text="{Binding SchemaName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>

                    <!-- Nome da Tabela -->
                    <StackPanel Margin="0,0,0,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Nome da Tabela:" FontWeight="Medium"/>
                            <TextBlock Style="{StaticResource InfoIconStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="Exemplo: dados_airflow, dados_maquinas"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </StackPanel>
                        <TextBox Text="{Binding TableName, UpdateSourceTrigger=PropertyChanged}" Padding="8,6"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Botões -->
            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <Button Content="Salvar e Conectar"
                        Command="{Binding SaveCommand}"
                        Background="#4472C4"
                        Foreground="White"
                        Padding="12,6"
                        Margin="5"
                        IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBoolConverter}}"/>

                <Button Content="{Binding TestConnectionButtonText}"
                        Command="{Binding TestConnectionCommand}"
                        Background="{Binding TestConnectionButtonBackground}"
                        Foreground="{Binding TestConnectionButtonForeground}"
                        Padding="12,6"
                        Margin="5"
                        IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"/>
            </StackPanel>

            <!-- Status -->
            <GroupBox Header="Status da Conexão" Margin="0,20,0,0" Padding="10">
                <StackPanel>
                    <TextBlock Text="{Binding StatusMessage}"
                               TextWrapping="Wrap"
                               Foreground="{Binding StatusMessageColor}"/>

                    <StackPanel Visibility="{Binding IsConnected, Converter={StaticResource BoolToVisibilityConverter}}"
                                Margin="0,10,0,0">
                        <TextBlock Text="✓ Conectado com sucesso!"
                                   FontWeight="Bold"
                                   Foreground="Green"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>
